name: CI Test
on: [push, pull_request]

jobs:
  test:
    strategy:
      fail-fast: false
      matrix:
        backend: [cc, cpp]
        allow-failure: [false]
        include:
          - backend: js
            allow-failure: true

    name: Backend ${{ matrix.backend }}
    runs-on: ubuntu-latest
    container:
      image: nimlang/nim:latest-alpine
      env:
        NIM_BACKEND: ${{ matrix.backend }}
    timeout-minutes: 30
    continue-on-error: ${{ matrix.allow-failure }}

    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Nim version
        run: nim --version
      - name: Build and run the tests
        run: |
          nimble install -dy
          nimble test
